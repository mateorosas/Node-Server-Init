<%- include("partials/_header") %>


  <div class="navigation">
    <input type="checkbox" class="navigation__checkbox" id="navi-toggle">
    <label for="navi-toggle" class="navigation__button">
      <span class="navigation__icon">&nbsp;</span>
    </label>

    <div class="navigation__background">&nbsp;</div>
    <nav class="navigation__nav">

      <div class="container-data">
        <div class="search">
          <input class="search--inputbox" aria-describedby="pac-input" id="pac-input" name="pac-input" type="text"
            placeholder="Busca tu producto" />
          <label aria-labelledby="pac-input" class="visually-hidden" for="pac-input" aria-hidden="true">Search</label>
          <button id="search--button" class="search--button" aria-hidden="true">
            <svg class="search--icon"></svg>
          </button>
        </div>

        <div class="container">
          <table class="container_tables container_tables--1">
            <thead>
              <tr>
                <th>#</th>
                <th>Tienda</th>
                <th>ID de producto</th>
                <th>Promedio Precio</th>
              </tr>
            </thead>
            <tbody>
              <% if (products && products.length> 0) { %>
                <% products.forEach((product, index)=> { %>
                  <tr>
                    <td>
                      <%= index + 1 %>
                    </td>
                    <td>
                      <%= product.tienda %>
                    </td>
                    <td>
                      <%= product.product_name %>
                    </td>
                    <td>
                      <%= product.average_price %>
                    </td>
                  </tr>
                  <% }) %>
                    <% } else { %>
                      <tr>
                        <td colspan="10">No products found</td>
                      </tr>
                      <% } %>
            </tbody>
          </table>

          <div class="results">

          </div>
        </div>
      </div>

    </nav>
  </div>

  <script type="text/javascript" async>
    document.addEventListener('DOMContentLoaded', () => {
      const input = document.getElementById('pac-input');
      const button = document.getElementById('search--button');
      const resultDiv = document.getElementById('results');


      const fetchProductData = async (productName) => {
        try {
          const response = await fetch(`/?nameProduct=${encodeURIComponent(productName)}`);
          if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
          }
          const data = await response.json();
          displayResults(data);
        } catch (error) {
          console.error('There was a problem with the fetch operation:', error);
          resultDiv.textContent = 'Error fetching data';
        }
      };

      const displayResults = (data) => {
        if (!data || data.length === 0) {
          resultDiv.innerHTML = '<p>No products found</p>';
          return;
        }

        let tableHTML = `
            <table class="container_tables container_tables--2">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Tienda</th>
                        <th>ID de producto</th>
                        <th>Promedio Precio</th>
                    </tr>
                </thead>
                <tbody>
        `;

        data.forEach((product, index) => {
          tableHTML += `
                <tr>
                    <td>${index + 1}</td>
                    <td>${product.tienda}</td>
                    <td>${product.product_name}</td>
                    <td>${product.average_price}</td>
                </tr>
            `;
        });

        tableHTML += `
                </tbody>
            </table>
        `;

        resultDiv.innerHTML = tableHTML;
      };

      const handleSubmit = () => {
        const productName = input.value.trim();
        if (productName) {
          fetchProductData(productName);
        } else {
          resultDiv.textContent = 'Please enter a product name';
        }
      };

      button.addEventListener('click', handleSubmit);

      input.addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
          event.preventDefault(); // Prevent form submission
          handleSubmit();
        }
      });
    });

  </script>

  <%- include("partials/_footer") %>